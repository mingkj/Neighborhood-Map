function initMap(){clearTimeout(mapRequestTimeout);var e=[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#cbe6a3"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#94a777"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#5f80e2"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#3f6eb0"}]}],t=new google.maps.StyledMapType(e,{name:"公园图"});map=new google.maps.Map(document.getElementById("map"),{center:{lat:39.913769,lng:116.395769},mapTypeControlOptions:{mapTypeIds:["styled_map","roadmap","satellite","hybrid","terrain"]},zoom:13}),map.mapTypes.set("styled_map",t),map.setMapTypeId("styled_map"),infoWindow=new google.maps.InfoWindow({maxWidth:200}),infoWindow.addListener("closeclick",function(){infoWindow.marker=null}),ko.applyBindings(new ViewModel)}var map,infoWindow,mapRequestTimeout=setTimeout(function(){alert("谷歌地图，请求失败。")},2e3),locations=[{title:"颐和园",location:{lat:40.00224,lng:116.276722}},{title:"圆明园",location:{lat:39.999512,lng:116.309649}},{title:"奥林匹克公园",location:{lat:39.992904,lng:116.390362}},{title:"北京动物园",location:{lat:39.940541,lng:116.3344}},{title:"北海公园",location:{lat:39.932269,lng:116.39011}},{title:"故宫博物院",location:{lat:39.91632,lng:116.397057}},{title:"中国国家博物馆",location:{lat:39.905095,lng:116.401563}},{title:"天坛",location:{lat:39.883331,lng:116.398945}}],Place=function(e){var t=this,o=function(e){return new google.maps.MarkerImage("https://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+e+"|40|_|%E2%80%A2",new google.maps.Size(22,40),new google.maps.Point(0,0),new google.maps.Point(10,40),new google.maps.Size(22,40))},n=o("FF0000"),l=o("00FF00");this.title=e.title,this.location=e.location,this.marker=new google.maps.Marker({position:e.location,icon:n,title:e.title,animation:google.maps.Animation.DROP}),this.showPlace=function(){t.marker.setMap(map)},this.hidePlace=function(){t.marker.setMap(null)},this.marker.addListener("click",function(){t.populateInfoWindow()}),this.marker.addListener("mouseover",function(){this.setIcon(l)}),this.marker.addListener("mouseout",function(){this.setIcon(n)}),this.defaultIcon=function(){t.marker.setIcon(n)},this.highlightIcon=function(){t.marker.setIcon(l)},this.populateInfoWindow=function(){if(infoWindow.marker!==t.marker){infoWindow.setContent(""),infoWindow.marker=t.marker;var e="<strong>"+t.marker.title+"</strong>";infoWindow.setContent(e);var o=setTimeout(function(){infoWindow.setContent(infoWindow.getContent()+"<br> wiki 简介加载失败")},5e3);$.getJSON("https://zh.wikipedia.org/w/api.php?callback=?",{search:t.marker.title,format:"json",action:"opensearch",dataType:"json"},function(e){for(var t,n=0;n<e[2].length&&(t=e[2][n],!(t.length>20));n++);infoWindow.setContent(infoWindow.getContent()+"<p>"+t+"</p>"),clearTimeout(o)});var n=setTimeout(function(){infoWindow.setContent(infoWindow.getContent()+"<br> flickr 简介加载失败")},5e3);$.getJSON("https://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?",{tags:t.marker.title,tagmode:"any",lang:"zh-cn",format:"json"},function(e){infoWindow.setContent(infoWindow.getContent()+'<br><img src="'+e.items[0].media.m+'">'),clearTimeout(n)}),infoWindow.open(map,t.marker)}else infoWindow.close(),infoWindow.marker=null}},ViewModel=function(){var e=this;this.placeList=ko.observableArray([]);var t=new google.maps.LatLngBounds;locations.forEach(function(o){var n=new Place(o);e.placeList.push(new Place(n)),t.extend(n.location)}),this.filterText=ko.observable(""),this.buttonText=ko.observable("隐藏"),this.changeButtonText=function(){"隐藏"===e.buttonText()?e.buttonText("显示"):e.buttonText("隐藏")},this.hideOrShow=ko.computed(function(){return"隐藏"===e.buttonText()}),this.searchFilter=ko.computed(function(){return map.fitBounds(t),infoWindow.close(),0===e.filterText().length?(e.placeList().forEach(function(e){e.showPlace()}),e.placeList()):ko.utils.arrayFilter(e.placeList(),function(t){var o=t.title.indexOf(e.filterText())>=0;return o?t.showPlace():t.hidePlace(),o})})};